# PACT: Policy Automation and Compliance Traceability

**PACT** is an intelligent compliance engine that turns "audit checklists" into a living, queryable knowledge graph.

Instead of chasing spreadsheets and screenshots, PACT automatically:
1.  **Ingests** security logs (from Splunk, CloudTrail, etc.).
2.  **Checks** them against rules (NIST, PCI, ISO) defined as code.
3.  **Visualizes** the "Blast Radius" of every failure.
4.  **Detects** when a secure system "drifts" into non-compliance.
5.  **Proves** it all to auditors with immutable evidence links.

---

## Quick Start (Test Mode)

### Test Credentials

For testing and demonstration purposes, the following accounts are pre-configured:

| Role | Email | Password |
|------|-------|----------|
| **Admin** | `admin@pact.io` | `Admin@123!` |
| **Compliance Officer** | `compliance.officer@pact.io` | `Compliance@123!` |
| **Security Engineer** | `security@pact.io` | `Security@123!` |
| **Developer** | `developer@pact.io` | `Developer@123!` |
| **System Owner** | `sysowner@pact.io` | `SysOwner@123!` |
| **CISO** | `ciso@pact.io` | `ChiefSec@123!` |
| **Internal Auditor** | `auditor@pact.io` | `Auditor@123!` |
| **External Auditor** | `external@pact.io` | `External@123!` |
| **Product Manager** | `pm@pact.io` | `ProductMgr@123!` |

> **Warning:** These are TEST credentials only. In production, use the bootstrap endpoint to create your first admin user with a strong password.

---

## New in Version 2.0

### Role-Based Access Control (RBAC)

PACT now supports 9 distinct user roles with granular permissions:

- **Admin** - Full system access, user management, configuration
- **Compliance Officer** - Policy management, framework configuration, full compliance view
- **Security Engineer** - Technical remediation, vulnerability tracking, system configuration
- **Developer** - Code-related compliance issues, CI/CD integration
- **System Owner** - Manage owned systems, view compliance status
- **CISO** - Executive dashboards, risk overview, audit preparation
- **Internal Auditor** - Read-only access to all compliance data, evidence review
- **External Auditor** - Limited read-only access for third-party audits
- **Product Manager** - Product compliance status, release gates

### System Lifecycle Management

Track systems through their entire lifecycle:
- **Planned** → **Active** → **Deprecated** → **Archived**
- Assign ownership, backup owners, and team responsibilities
- Link systems to business processes and products

### Document & Evidence Management

- Upload policy documents, procedures, and manual evidence
- Version control for compliance documentation
- Expiration alerts for documents requiring periodic review
- Auditor evidence request workflows

### Historical "Time Machine"

- View compliance state at any point in time
- Compare compliance between two dates
- Track drift and remediation over time

### Incident Correlation

- Link security incidents to compliance gaps
- Track near-misses and their relationship to controls
- Measure control effectiveness over time

---

## The Problem vs. The Solution

| The Old Way (Manual Compliance) | The PACT Way (Semantic Compliance) |
| :--- | :--- |
| **Snapshot in Time:** "It was secure last month." | **Continuous:** "It became insecure 5 minutes ago." |
| **Spreadsheets:** Manual data entry & errors. | **Knowledge Graph:** Auto-generated relationships. |
| **Siloed:** Compliance doesn't know about Engineering. | **Unified:** Maps `Failed Control` → `Git Commit`. |
| **Opaque:** "Why did we fail?" | **Traceable:** "We failed because of *this* log file." |

---

## Architecture: How It Works

PACT acts as the "Brain" between your Data (Logs) and your Rules (Policy). See the full **[System Architecture Documentation](docs/architecture.md)** for technical diagrams and data flow details.

```mermaid
graph TD
    subgraph inputs [1. INPUTS]
    A[Logs / Splunk] -->|Ingest| E(PACT Engine)
    B[Policy / Gemara] -->|Rules| E
    end

    subgraph engine [2. THE ENGINE]
    E -->|Build| G{Knowledge Graph}
    G -->|Link| H[Evidence]
    G -->|Map| I[Business Process]
    end

    subgraph outputs [3. OUTPUTS]
    G -->|Visualizes| J[Real-Time Dashboard]
    G -->|Explains| K[AI Auditor Chatbot]
    G -->|Reports| L[NIST OSCAL JSON]
    end
```

### Key Components

1.  **The Graph:** We don't just store data; we store *context*. We know that `Server A` supports the `Payment Process` and is owned by `FinTech-Ops`.
2.  **The Rules (SHACL):** Policies are written in standard W3C shapes. We fully support rules generated by **Gemara** and **ComplyTime**.
3.  **The Drift Detector:** PACT remembers history. It can tell you: *"This system passed on Monday but failed on Tuesday."*
4.  **The Cross-Walk:** Fail a NIST control? PACT instantly tells you if that also violates **PCI-DSS**, **ISO 27001**, or **SOC 2**.

---

## The Ecosystem: UCO, Gemara, and ComplyTime

PACT doesn't operate in a vacuum. It is built on open standards to ensure interoperability across the cybersecurity industry.

### 1. UCO (Unified Cyber Ontology)
PACT uses **UCO** as its internal language. By mapping raw logs (like Splunk or AWS CloudTrail) into UCO observables, we ensure that a "File" or a "User" is defined the same way regardless of the source.

### 2. Gemara (Policy Compiler)
**Gemara** is the "legal translator" for PACT. While PACT executes the checks, Gemara is used to author and compile high-level regulatory guidance (like NIST SP 800-53) into the technical **SHACL rules** that PACT understands.

### 3. ComplyTime (Governance Lifecycle)
**ComplyTime** provides the broader context for digital trust. PACT feeds ComplyTime with real-time evidence and **NIST OSCAL** reports.

---

## Key Features

### 1. Blast Radius Analysis
Don't just fix a server; save a business process. PACT links low-level technical failures to high-level business impact.

> *"Warning: The failure on 'Payment Gateway' is blocking the 'Credit Card Processing' function."*

### 2. Temporal Drift Detection
Systems rot over time. PACT catches "Configuration Drift" by comparing today's graph against yesterday's.

> *"Alert: `sensitive_config.yaml` passed checks for 90 days but was changed by `root` at 3:45 PM today."*

### 3. AI Auditor
Ask plain English questions to your compliance data.

*   **User:** *"Why is the HR Portal failing?"*
*   **PACT AI:** *"The HR Portal failed NIST AC-3 because `critical_secrets.yaml` is world-readable. This also violates PCI Req 7.1."*

### 4. Automated Reporting (OSCAL)
Stop writing Word docs. PACT exports a valid **NIST OSCAL** Assessment Results file, ready for submission to FedRAMP, eMASS, or ComplyTime.

---

## Getting Started

### Prerequisites
*   Python 3.10+
*   **Ollama** (Recommended for Local AI) or OpenAI API Key

### Local AI Setup (Beginner Friendly)
PACT uses a local AI to help you understand your compliance data without sending your data to the cloud.

1.  **Download Ollama:** Go to [ollama.com](https://ollama.com) and download the app.
2.  **Install the Model:**
    ```bash
    ollama run granite3.3:8b
    ```
3.  **Keep it Running:** Make sure the Ollama app is running in your menu bar.

### Installation
```bash
# Clone the repo
git clone https://github.com/your-org/pact.git
cd pact

# Create virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt
```

### Running the Server
```bash
# Start the PACT Server
./venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8002 --reload
```

### First-Time Setup (Bootstrap)

If this is a fresh installation with no users, bootstrap the first admin:

```bash
curl -X POST http://localhost:8002/v1/auth/bootstrap \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@yourcompany.com",
    "password": "YourSecurePassword123!",
    "full_name": "System Administrator",
    "role": "admin"
  }'
```

### Access the Dashboard

1. Navigate to [http://localhost:8002/visualize](http://localhost:8002/visualize)
2. Log in with your credentials (or use test credentials above)
3. Explore the dashboard based on your role

---

## API Reference

PACT exposes a RESTful API at `/v1/`. Key endpoints:

| Category | Endpoints | Description |
|----------|-----------|-------------|
| **Authentication** | `POST /v1/auth/login`, `/register`, `/bootstrap` | User authentication and registration |
| **Users** | `GET/POST/PATCH/DELETE /v1/users` | User management (Admin only) |
| **Systems** | `GET/POST/PATCH/DELETE /v1/systems` | System lifecycle management |
| **Documents** | `GET/POST /v1/documents` | Evidence and document management |
| **Compliance** | `GET /v1/compliance/blast-radius`, `/drift`, `/stats` | Compliance data and analysis |
| **History** | `GET /v1/history/at`, `/timeline`, `/compare` | Historical compliance views |
| **Chat** | `POST /v1/chat` | AI Auditor queries |
| **Ingest** | `POST /v1/ingest` | Ingest security events |

Full API documentation available at [http://localhost:8002/docs](http://localhost:8002/docs)

---

## Documentation

| Document | Description |
|----------|-------------|
| [User Guide](docs/user-guide.md) | How to use PACT for compliance monitoring |
| [Administrator Guide](docs/administrator-guide.md) | Installation, configuration, and maintenance |
| [Architecture](docs/architecture.md) | Technical architecture and data flows |
| [API Reference](http://localhost:8002/docs) | Interactive Swagger documentation |

---

## Integrations

*   **Gemara:** We natively consume SHACL rules compiled by the Gemara Policy Compiler.
*   **ComplyTime:** We export results that fit into the ComplyTime lifecycle.
*   **Splunk / OCSF:** We ingest standard JSON security logs.
*   **CI/CD:** API-first design enables integration with GitHub Actions, GitLab CI, etc.

---

## License
MIT License. Open Source and ready for the community.
